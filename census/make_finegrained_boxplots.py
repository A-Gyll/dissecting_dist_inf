import seaborn as sns
import matplotlib.pyplot as plt
import argparse
from utils import flash_utils, get_n_effective, bound
import numpy as np
from data_utils import SUPPORTED_PROPERTIES
import matplotlib as mpl
mpl.rcParams['figure.dpi'] = 200


if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument('--darkplot', action="store_true",
                        help='Use dark background for plotting results')
    parser.add_argument('--filter', choices=SUPPORTED_PROPERTIES,
                        help='name for subfolder to save/load data from')
    parser.add_argument('--mode', choices=["meta", "threshold"],
                        default="meta",
                        help='name for subfolder to save/load data from')
    args = parser.parse_args()
    flash_utils(args)

    # Set font size
    plt.rcParams.update({'font.size': 6})
    plt.rc('xtick', labelsize=9)
    plt.rc('ytick', labelsize=9)
    plt.rc('axes', labelsize=10)

    if args.darkplot:
        # Set dark background
        plt.style.use('dark_background')

    targets = ["0.0", "0.1", "0.2", "0.3", "0.4",
               "0.5", "0.6", "0.7", "0.8", "0.9", "1.0"]

    fill_data = np.zeros((len(targets), len(targets)))
    mask = np.ones((len(targets), len(targets)), dtype=bool)
    annot_data = [[None] * len(targets) for _ in range(len(targets))]
    if args.filter == "sex":
        raw_data_meta = [
            [
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
                [99.95, 99.95, 99.95, 99.95, 100, 99.95, 100, 100, 100, 99.95],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 99.5],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
                [99.95, 99.95, 99.95, 100, 100, 99.95, 99.95, 99.95, 97.85, 99.95]
            ],
            [
                [51.55, 52.55, 51.4, 54.1, 51.9, 52.05, 52.55, 51.55, 52.3, 52.5],
                [61.45, 60.4, 59.1, 58.9, 57.35, 60.9, 59.55, 58.5, 58.85, 59.4],
                [68.0, 64.25, 65.85, 66.8, 67.55, 65.4, 67.1, 66.15, 65.0, 66.0],
                [75.1, 78.23, 71.83, 68.567, 75.73, 75.2, 74.767, 74.467, 67.3, 71.03],
                [77.7, 77.45, 76.15, 73.9, 76.15, 76.65, 77.05, 75.3, 75.55, 78.15],
                [80.85, 78.95, 80.65, 79.65, 79.3, 82.75, 80.75, 67.55, 77.5, 80.4],
                [80.3, 81.75, 75.3, 71.65, 81.0, 78.9, 81.1, 79.5, 83.15, 84.1],
                [78.6, 86.05, 81.15, 82.9, 84.4, 82.3, 87.85, 84.8, 84.75, 85.1],
                [72.05, 72.8, 73.95, 75.7, 70.05, 74.25, 70.3, 65.95, 83.9, 85.2]
            ],
            [
                [52.5, 51.65, 51.2, 50.85, 52.0, 48.7, 52.3, 50.75, 50.05, 49.8],
                [55.7, 57.1, 56.3, 55.9, 57.9, 55.85, 57.3, 58.3, 57.6, 53.9],
                [63.836, 56.7676, 63.2676, 57.567, 50.6764, 59.234, 60.367, 57.13, 56.53, 54.367],
                [63.1, 64.9, 63.5, 64.4, 66.0, 66.25, 65.9, 64.45, 61.6, 65.0],
                [62.35, 64.05, 69.45, 72.95, 65.75, 61.55, 66.25, 61.8, 69.4, 66.55],
                [60.4, 64.3, 70.55, 62.55, 66.1, 61.6, 68.45, 66.6, 64.95, 68.95],
                [72.7, 64.35, 72.2, 73.65, 68.3, 68.95, 68.05, 73.9, 66.8, 71.6],
                [100.0, 98.6, 66.65, 78.05, 80.65, 75.6, 69.95, 100.0, 69.95, 100.0],
            ],
            [
                [51.3, 50.8, 50.75, 49.75, 49.1, 49.95, 50.8, 49.05, 51.15, 49.3],
                [55.067, 52.734, 56.13, 52.5, 50.2, 55.734, 52.7676, 51.03, 52.867, 50.367],
                [58.05, 57.25, 59.2, 59.5, 60.35, 58.35, 60.1, 59.85, 58.6, 59.2],
                [55.45, 55.8, 58.1, 61.75, 63.45, 56.1, 62.75, 65.4, 61.85, 64.75],
                [53.05, 59.45, 66.05, 61.1, 64.5, 57.8, 59.4, 54.05, 57.8, 61.45],
                [64.65, 65.4, 57.1, 70.4, 60.9, 67.75, 65.35, 63.65, 64.95, 64.2],
                [81.4, 69.15, 100.0, 100.0, 69.65, 74.55, 71.25, 77.9, 67.95, 80.85],
            ],
            [
                [47.3, 50.867, 46.1674, 51.2676, 47.13, 49.6, 49.336, 51.467, 47.1, 53.367],
                [51.45, 53.25, 52.95, 53.75, 51.95, 54.3, 54.85, 54.1, 56.05, 53.1],
                [55.75, 56.55, 55.1, 53.95, 51.9, 56.3, 58.15, 53.3, 57.65, 53.45],
                [55.25, 53.95, 54.5, 53.6, 55.05, 53.75, 56.2, 53.7, 56.75, 58.0],
                [61.1, 66.15, 62.75, 58.95, 64.9, 63.65, 60.35, 61.55, 63.2, 58.45],
                [72.4, 67.5, 74.95, 67.5, 67.45, 100.0, 99.95, 100.0, 72.35, 71.65]
            ],
            [
                [52.734, 55.234, 53.53, 52.1, 59.336, 55.2676, 58.0, 57.7, 61.93, 51.43],
                [64.667, 62.567, 61.63, 62.6, 63.7676, 63.93, 64.267, 58.43, 63.7, 63.067],
                [67.73, 68.067, 67.3, 66.9, 66.83, 67.067, 67.367, 67.8, 67.7, 68.2],
                [71.467, 72.1, 70.53, 70.23, 71.0, 70.867, 70.367, 70.934, 70.3, 70.8],
                [82.067, 99.73, 99.0, 81.267, 80.1, 77.867, 78.634, 77.73, 78.8, 82.367]
            ],
            [
                [49.9, 51.1, 50.95, 50.45, 50.25, 50.75, 49.45, 50.3, 51.3, 52.35],
                [52.6, 53.3, 51.6, 53.5, 50.35, 51.05, 54.5, 53.0, 52.25, 52.0],
                [56.2, 55.25, 55.9, 59.95, 55.15, 56.9, 55.65, 55.8, 58.8, 58.1],
                [72.25, 71.4, 69.5, 100.0, 83.6, 100.0, 72.65, 68.75, 66.05, 66.9],
            ],
            [
                [49.65, 52.2, 51.95, 51.6, 50.75, 52.75, 52.65, 52.2, 51.6, 51.1],
                [60.7, 61.35, 59.3, 61.05, 57.05, 58.75, 60.05, 59.0, 56.75, 59.95],
                [68.3, 73.9, 71.95, 66.4, 99.95, 84.1, 72.55, 73.0, 83.8, 66.5]
            ],
            [
                [56.5, 56.35, 55.05, 55.25, 56.7, 55.45, 55.2, 56.3, 55.0, 54.6],
                [87.0, 66.45, 72.5, 79.4, 70.4, 71.95, 100.0, 65.95, 76.3, 72.65]
            ],
            [
                [100.0, 72.9, 73.85, 71.75, 73.2, 72.15, 72.4, 75.95, 66.05, 100.0]
            ]
        ]
        raw_data_threshold = [
            [
                [78.5, 74.8, 74.35, 78.75, 76.8],
                [89.2, 88.75, 88.5, 85.75, 88.6],
                [91.9, 92.65, 91.7, 90.4, 92.65],
                [91.2, 90.35, 92, 85.1, 90.65],
                [64.05, 61.60, 63.45, 63.60, 59.00, 61.65, 64.35, 63.35, 62.25, 63.55],
                [84.8, 82, 84, 87.05, 85.5],
                [90.85, 89.5, 91.35, 90.3, 91.4],
                [94.1, 92.9, 93.35, 93.85, 93.85],
                [94.5, 93.3, 93.05, 94.55, 94.7],
                [98.05, 98.05, 94.6, 98.1, 98.1]
            ],
            [
                [55.6, 54.65, 53.55, 54.2, 54.2],
                [50.8, 56.85, 56.5, 52.15, 57.1],
                [50.95, 54.2, 53.55, 55.75, 53.95],
                [55.35, 60.35, 65.00, 59.65, 61.20, 54.35, 60.90, 56.70, 60.55, 57.60],
                [83.35, 81, 82.2, 80.9, 81.75],
                [92.5, 92.65, 93.3, 91, 92.55],
                [95.75, 95, 94.9, 94.65, 94.5],
                [95.65, 95.75, 94.15, 96.3, 96.15],
                [58.3, 58.65, 98.35, 56.65, 60.3]
            ],
            [
                [50.85, 50.85, 50.9, 50, 52.9],
                [59.3, 55.5, 58.2, 56.4, 57.65],
                [65.45, 62.85, 55.05, 61.35, 59.15, 60.00, 59.40, 66.25, 60.90, 61.40],
                [81.85, 83.65, 81.95, 84.55, 83.85],
                [93.25, 93.65, 93.05, 93.05, 80.06],
                [95.75, 95.45, 95.9, 96.05, 95.2],
                [96.6, 95.75, 71.7, 96.05, 95.85],
                [98.85, 62.75, 64.55, 99.2, 98.85],
            ],
            [
                [55.4, 57.2, 56.05, 55.35, 57.7],
                [60.95, 67.40, 61.25, 64.10, 66.60, 58.00, 62.40, 64.60, 62.60, 66.00],
                [82.5, 82.1, 81.6, 82, 83.5],
                [92.75, 92.75, 91.65, 91.45, 92.75],
                [92.2, 94.85, 94.75, 95.35, 94],
                [95.25, 95.2, 94.9, 94.65, 95.45],
                [98.45, 66.1, 97.45, 98.7, 68.15]
            ],
            [
                [61.85, 59.10, 54.95, 56.65, 60.55, 61.95, 60.80, 61.20, 61.75, 59.90],
                [73.65, 72.35, 76.2, 73.35, 76.1],
                [89.1, 87.5, 88, 88.7, 88.1],
                [89.65, 92.25, 90.4, 90.85, 92.05],
                [90.85, 91.6, 92.4, 91.15, 19.95],
                [95.65, 91.95, 90.8, 89.9, 91.95]
            ],
            [
                [64.05, 63.65, 63.90, 62.35, 64.20, 62.90, 64.15, 61.50, 62.85, 63.15],
                [68.35, 76.40, 69.65, 74.05, 76.30, 76.20, 74.85, 75.30, 75.80, 75.90],
                [76.65, 77.90, 77.15, 74.05, 78.50, 74.90, 80.55, 82.80, 74.10, 74.00],
                [70.80, 71.55, 70.25, 68.50, 70.30, 65.45, 70.15, 70.45, 66.00, 71.35],
                [60.30, 62.20, 61.30, 53.80, 57.15, 62.75, 62.50, 62.00, 60.40, 61.85],
            ],
            [
                [67.4, 65, 65.25, 64.15, 63.3],
                [73.95, 73.2, 68.5, 74.7, 73.95],
                [64, 70.6, 70.25, 70.95, 69.4],
                [86.25, 86.35, 83.45, 84.45, 79.8]
            ],
            [
                [57.15, 56.45, 55.5, 57.2, 55.05],
                [55.3, 51.1, 52.9, 50.75, 51.9],
                [69.75, 65, 58.55, 57, 72.6]
            ],
            [
                [55.2, 51.05, 56.2, 56.7, 56.45],
                [61.85, 63.1, 59.45, 63.7, 62.6],
            ],
            [
                [57.3, 60.35, 50.1, 54.2, 55.75]
            ]
        ]
        raw_data_loss = [
            [57.16, 56.82, 57.18, 57.14, 56.37, 57.1, 56.39, 57.13, 56.99, 56.8],
            [50, 50, 50, 50, 50, 50, 50, 49.95, 50],
            [50, 50, 50, 50, 50, 50, 49.95, 50],
            [50, 50, 50, 50, 50, 49.95, 50],
            [50, 50, 50, 50, 49.95, 50],
            [49.97, 50, 50, 49.95, 50],
            [50.06, 50, 49.95, 50],
            [49.98, 49.95, 50],
            [49.95, 50],
            [50.05]
        ]
    elif args.filter == "race":
        raw_data_meta = [
            [
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
                [100.0, 99.95, 100.0, 100.0, 100.0, 100.0, 99.95, 100.0, 100.0, 100.0],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 99.95, 100.0, 100.0, 99.95]
            ],
            [
                [51.8, 51.35, 51.4, 52.0, 52.3],
                [55.8, 55.6, 53.9, 55.65, 55.1],
                [55.9, 56.55, 56.45, 54.55, 55.9],
                [56.25, 53.75, 56.6, 56.3, 55.55, 57.55, 55.8, 55.95, 56.3, 58.7],
                [50.6, 53.15, 52.55, 51.95, 55.15],
                [51.05, 51.25, 50.85, 49.4, 50.25],
                [51.0, 50.9, 50.9, 51.4, 50.55],
                [51.46, 52, 51.86, 51.01, 50.47],
                [99.95, 99.9, 100.0, 100.0, 99.95, 100.0, 100.0, 100.0, 100.0, 100.0]
            ],
            [
                [52.5, 56.05, 52.95, 54.7, 54.45],
                [58.3, 55.25, 58.95, 58.95, 56.25],
                [55.1, 53.8, 54.65, 53.0, 53.4, 53.7, 53.65, 54.65, 54.7, 52.2],
                [54.1, 53.8, 53.8, 52.5, 53.0],
                [50.85, 51.1, 51.1, 51.65, 50.9],
                [51.0, 49.55, 50.6, 50.05, 49.9],
                [51.31, 50.42, 49.78, 52.7, 50.96],
                [99.95, 99.9, 100.0, 100.0, 99.95, 100.0, 100.0, 100.0, 100.0, 100.0]
            ],
            [
                [50.0, 49.1, 53.4, 49.05, 49.4, 48.75, 50.35, 50.45, 49.9, 50.6],
                [54.45 , 53.1 , 52.85 , 52.35 , 51.75 , 53.05 , 51.85 , 53.25 , 52.25 , 51.8],
                [50.4, 51.3, 53.05, 52.45, 50.35, 51.0, 52.55, 50.05, 51.95, 51.65],
                [50.55, 49.85, 49.85, 49.9, 50.65, 50.25, 49.55, 49.0, 49.6, 49.6],
                [49.4, 49.9, 50.8, 49.55, 49.85, 49.6, 49.95, 50.0, 48.95, 49.5],
                [52.25, 50.22, 49.68, 51.86, 50.12, 51.81, 50.82, 50.62, 51.31, 50.42],
                [100.0, 100.0, 100.0, 100.0, 99.95, 100.0, 100.0, 100.0, 100.0, 100.0]
            ],
            [
                [50.25 , 51.6 , 49.2 , 49.6 , 50.05 , 49.7 , 49.35 , 50.2 , 50.4 , 50.85],
                [51.55, 49.4, 50.45, 50.1, 51.1, 51.4, 51.55, 49.65, 51.25, 51.75],
                [51.15, 52.1, 48.75, 49.75, 53.35, 51.05, 53.95, 48.95, 51.9, 53.7],
                [48.6, 48.65, 48.65, 50.75, 50.35, 54.1, 49.25, 52.6, 54.1, 50.9],
                [52.30, 53.19, 52.70, 55.32, 49.04, 48.44, 54.82, 55.22, 54.38, 51.61],
                [100.0, 100.0, 100.0, 100.0, 99.95, 100.0, 100.0, 100.0, 100.0, 100.0]
            ],
            [
                [51.15, 49.3, 51.15, 48.7, 49.7, 49.55, 50.35, 50.3, 50.25, 51.1],
                [51.95, 51.8, 49.45, 49.9, 50.9, 51.7, 53.9, 49.45, 49.55, 49.25],
                [54.95, 52.4, 56.3, 49.9, 51.1, 56.7, 54.9, 50.4, 54.3, 49.5],
                [51.26, 51.21, 51.56, 53.39, 51.41, 54.13, 49.73, 51.81, 50.07, 53.19],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0]
            ],
            [
                [50.55, 51.15, 50.7, 50.4, 52.15, 50.75, 51.8, 51.9, 50.7, 51.05],
                [50.5, 50.1, 50.55, 52.95, 51.15, 53.05, 52.15, 54.55, 51.75, 52.55],
                [59.03, 51.41, 56.70, 56.51, 57.74, 58.63, 54.92, 54.73, 55.47, 56.61],
                [99.95, 100.0, 100.0, 100.0, 99.95, 99.95, 99.95, 100.0, 100.0, 99.95]
            ],
            [
                [51.9, 56.55, 48.4, 53.25, 53.3, 55.7, 53.95, 52.85, 54.15, 54.2],
                [65.22, 67.49, 59.77, 59.52, 57.15, 63.14, 64.67, 62.59, 65.46, 60.47],
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0],
            ],
            [
                [59.43, 55.81, 60.91, 57.40, 56.56, 55.76, 54.18, 55.22, 57.01, 57.25],
                [99.95, 99.95, 100, 100, 99.95, 99.95, 99.95, 100, 100, 99.95],
            ],
            [
                [100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0]
            ]
        ]

        raw_data_threshold = [
            [
                [65.75, 58.90, 53.65, 56.10, 69.95],
                [74.70, 71.65, 59.25, 73.55, 72.25],
                [75.95, 75.40, 77.25, 76.85, 74.80],
                [80.15, 71.25, 68.10, 73.55, 71.55],
                [80.10, 79.70, 72.90, 78.65, 78.20, 72.10, 78.50, 77.45, 75.25, 79.90],
                [86.00, 81.95, 83.80, 83.35, 85.40],
                [86.15, 90.40, 85.70, 87.75, 91.15],
                [77.75, 90.40, 87.90, 83.30, 91.15],
                [76.75, 88.35, 85.40, 88.10, 88.20],
                [94.40, 96.45, 93.95, 93.95, 89.10]
            ],
            [
                [46.50, 54.35, 46.55, 55.05, 54.95],
                [56.80, 59.95, 52.85, 60.20, 60.35],
                [64.85, 64.65, 66.35, 67.00, 68.05],
                [69.15, 70.70, 63.50, 63.75, 63.30, 56.80, 62.95, 72.50, 68.95, 68.25],
                [84.40, 80.35, 75.80, 82.45, 78.35],
                [80.85, 89.75, 89.95, 88.20, 90.65],
                [87.20, 83.45, 86.70, 88.30, 86.55],
                [83.25, 87.45, 83.20, 85.10, 82.20],
                [92.60, 93.00, 89.85, 96.60, 96.25]
            ],
            [
                [53.45, 54.85, 51.95, 53.25, 51.05],
                [59.65, 60.90, 58.15, 59.35, 60.40],
                [66.15, 62.00, 64.85, 60.95, 61.80, 66.10, 63.65, 64.20, 63.35, 60.85],
                [75.15, 83.70, 79.70, 83.65, 81.30],
                [85.65, 87.95, 82.90, 86.80, 87.80],
                [84.15, 68.30, 86.20, 85.00, 86.15],
                [84.15, 79.50, 81.90, 86.20, 88.00],
                [88.10, 93.45, 93.70, 91.85, 88.45]
            ],
            [
                [56.45, 55.95, 55.90, 55.20, 56.25],
                [60.85, 61.00, 58.55, 67.60, 60.20, 52.85, 62.50, 65.05, 64.25, 57.75],
                [68.80, 71.90, 75.65, 68.20, 76.05],
                [80.60, 85.80, 82.30, 84.00, 81.15],
                [78.70, 82.15, 76.40, 76.05, 77.50],
                [78.45, 80.65, 70.85, 77.55, 81.40],
                [87.85, 88.70, 89.80, 86.30, 89.80]
            ],
            [
                [52.45, 60.75, 57.75, 58.20, 57.95, 57.85, 58.70, 58.60, 57.40, 59.60],
                [68.50, 62.60, 57.15, 64.95, 67.00],
                [74.60, 78.35, 72.95, 68.15, 78.65],
                [74.75, 75.55, 74.30, 73.05, 69.70],
                [72.50, 59.20, 71.90, 67.75, 65.45],
                [83.25, 81.85, 78.60, 81.50, 80.75]
            ],
            [
                [53.70, 54.55, 56.25, 57.20, 58.30, 55.15, 56.70, 53.65, 55.20, 54.65],
                [58.70, 63.05, 62.85, 60.30, 65.05, 63.70, 62.00, 62.25, 65.95, 65.80],
                [65.70, 58.70, 63.80, 62.20, 53.80, 59.30, 60.70, 56.85, 55.85, 58.75],
                [55.15, 51.35, 50.70, 54.40, 54.75, 51.15, 51.65, 52.55, 51.05, 50.35],
                [50.95, 59.00, 58.00, 59.00, 56.85, 59.00, 56.30, 59.70, 59.00, 59.70]
            ],
            [
                [55.60, 57.70, 58.85, 56.20, 58.10],
                [55.40, 54.40, 53.95, 53.35, 56.35],
                [51.15, 53.05, 47.75, 51.50, 55.20],
                [69.45, 61.15, 67.05, 64.10, 68.40]
            ],
            [
                [54.00, 53.65, 53.65, 47.30, 52.45],
                [57.60, 60.35, 58.30, 56.75, 60.35],
                [66.65, 59.60, 58.75, 65.45, 61.40]
            ],
            [
                [54.90, 55.95, 55.85, 55.45, 55.85],
                [56.75, 61.85, 53.95, 56.50, 59.95]
            ],
            [
                [56.20,56.80,58.05,52.40,43.85]
            ]
        ]
        raw_data_loss = [
            [72.09, 70.36, 68.51, 71.42, 57, 69.31, 70.73, 69.73, 70.72, 71.1],
            [50.31, 50.29, 50.12, 50, 50, 50.14, 50.04, 50, 50],
            [50.23, 50, 50, 49.95, 50, 49.95, 49.95, 49.95],
            [49.21, 50, 50.05, 52.74, 50, 50, 50],
            [50, 47.28, 51.41, 50.01, 49.97, 49.95],
            [50, 50.35, 50.05, 50.05, 50.05],
            [50.62, 50.63, 51.22, 50],
            [49.18, 50, 50.02],
            [51.92, 50.06],
            [51.74]
        ]
    else:
        exit(0)

    if args.mode == "meta":
        data_use = raw_data_meta
    else:
        data_use = raw_data_threshold

    for i in range(len(targets)):
        for j in range(len(targets)-(i+1)):
            m, s = np.mean(data_use[i][j]), np.std(data_use[i][j])
            fill_data[i][j+i+1] = m
            mask[i][j+i+1] = False
            annot_data[i][j+i+1] = r'%d $\pm$ %d' % (m, s)

    if args.mode != "meta":
        for i in range(len(targets)):
            for j in range(len(targets)-(i+1)):
                fill_data[j+i+1][i] = raw_data_loss[i][j]
                mask[j+i+1][i] = False
                annot_data[j+i+1][i] = r'%d' % (raw_data_loss[i][j])

        for i in range(len(targets)):
            fill_data[i][i] = 0
            mask[i][i] = False
            annot_data[i][i] = "N.A."
 
    # max_values = np.zeros_like(fill_data)
    # eff_vals = np.zeros_like(fill_data)
    # for i in range(len(targets)):
    #     for j in range(len(targets)-(i+1)):
    #         wanted = raw_data_meta[i][j]
    #         i_ = float(targets[i])
    #         j_ = float(targets[j+i+1])
    #         if i_ == 0.1 and j_ == 0.3:
    #             n_vals = np.array([get_n_effective(zz / 100., i_, j_) for zz in wanted])
    #         else:
    #             continue
    #         # print(n_vals)
    #         n_vals[np.abs(n_vals) == np.inf] = 1000
    #         max_values[i][j+i+1] = np.mean(n_vals)
    #         n_eff = get_n_effective(
    #             max_values[i][j+i+1] / 100, float(targets[i]), float(targets[j]))
    #         eff_vals[i][j+i+1] = n_eff
    #         # print(i, j, bound(float(targets[i]), float(targets[j]), n_eff))
    # for v in eff_vals:
    #     print(" , ".join(["%.2f" % vv for vv in v]))
    # exit(0)

    #track max values
    max_values = np.zeros_like(fill_data)
    eff_vals = np.zeros_like(fill_data)
    wanted = []
    for i in range(len(targets)):
        for j in range(len(targets)-(i+1)):
            # n_eff_loss = get_n_effective(raw_data_loss[i][j] / 100, float(targets[i]), float(targets[i+j+1]))
            n_eff_loss = get_n_effective(
                max(raw_data_meta[i][j]) / 100, float(targets[i]), float(targets[i+j+1]))
            if float(targets[i]) == 0.5:
                wanted.append(n_eff_loss)
                print(n_eff_loss, targets[i+j+1])
            if float(targets[i+j+1]) == 0.5:
                wanted.append(n_eff_loss)
                print(n_eff_loss, targets[i])
            max_values[i][j+i+1] = max(raw_data_loss[i]
                                       [j], max(raw_data_threshold[i][j]))
            max_values[i][j+i+1] = max(max_values[i]
                                       [j], max(raw_data_meta[i][j]))
            n_eff = get_n_effective(
                max_values[i][j+i+1] / 100, float(targets[i]), float(targets[i+j+1]))
            eff_vals[i][j] = np.abs(n_eff)
            # print(targets[i], targets[i+j+1], eff_vals[i][j],
            #       bound(float(targets[i]), float(targets[j]), n_eff))
    # print("Average", np.mean(wanted))
    wanted = np.array(wanted)
    wanted = wanted[np.abs(wanted) != np.inf]
    print("Median:", np.median(wanted))
    print(np.min(wanted), np.max(wanted))
    exit(0)
    for i in range(len(targets)):
        print(['%.2f' % x for x in eff_vals[i][:len(targets)-(i+1)]])

    eff_vals_mean = eff_vals.flatten()
    eff_vals_mean = eff_vals_mean[eff_vals_mean != np.inf]
    eff_vals_mean = eff_vals_mean[eff_vals_mean > 0]
    print("Mean N_leaked value: %.2f" % np.mean(eff_vals_mean))
    print("Median N_leaked value: %.2f" % np.median(eff_vals_mean))

    sns_plot = sns.heatmap(fill_data, xticklabels=targets, yticklabels=targets,
                           annot=annot_data, mask=mask,
                           fmt="^", vmin=50, vmax=100)
    sns_plot.set(xlabel=r'$\alpha_0$', ylabel=r'$\alpha_1$')
    sns_plot.figure.savefig("./meta_heatmap_%s_%s.png" %
                            (args.filter, args.mode))
